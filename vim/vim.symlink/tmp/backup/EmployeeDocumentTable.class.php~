<?php

/**
 * EmployeeDocumentTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class EmployeeDocumentTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object EmployeeDocumentTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('EmployeeDocument');
    }
    public function addDocument($employee_id, $document_id){
      try{
        $employee_document = new EmployeeDocument();
        $employee_document->employee_id = $employee_id;
        $employee_document->document_id = $document_id;
        $employee_document->save();
      } catch(Doctrine_Connection_Exception $e) {
        if($e->getPortableCode() !== Doctrine_Core::ERR_ALREADY_EXISTS){
          throw $e;
        }
        $employee_document = $this->createQuery('ed')
          ->where('ed.employee_id = ?', $employee_id)
          ->andWhere('ed.document_id = ?', $document_id)
          ->fetchOne();
      }
      return $employee_document;
    }
    public function markAsRead($employee_id, $document_id){
        $employee_document = $this->createQuery()
          ->update('EmployeeDocument')
          ->set('read_time', '?', date ("Y-m-d H:i:s"))
          ->where('employee_id = ?', $employee_id)
          ->andWhere('document_id = ?', $document_id);
        return $employee_document->execute();
    }
    public function getEmployeeDocuments($employee_id){
      return $this->createQuery('ed')
        ->leftJoin('ed.Document d')
        ->where('ed.employee_id = ?', $employee_id)
        ->orderby('ed.created_at')
        ->execute();
    }
}
