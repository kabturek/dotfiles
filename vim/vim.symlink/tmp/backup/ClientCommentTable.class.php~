<?php

/**
 * ClientCommentTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ClientCommentTable extends Doctrine_Table
{
    /**
     * Returns an instance of this class.
     *
     * @return object ClientCommentTable
     */
    public static function getInstance()
    {
        return Doctrine_Core::getTable('ClientComment');
    }
    public function filterEmployee($filters){
      $q = $this->createQuery('c')
        ->leftJoin('c.EmployeeClientComment ecc')
        ->leftJoin('c.ClientCommentAreas a')
        ->where('ecc.employee_id = ?', $filters['employee_id']);
      if(!empty($filters['date_start']['date'])){
        $q->andWhere('c.date >= ?', $filters['date_start']['date']);
      }
      if(!empty($filters['date_stop']['date'])){
        $q->andWhere('c.date <= ?', $filters['date_stop']['date']);
      }
      if(!empty($filters['type'])){
        $q->andWhereIn('c.type', array_values($filters['type']));
      }
      if(isset($filters['is_valid']) && $filters['is_valid'] !== ''){
        $q->andWhere('c.is_valid = ?', $filters['is_valid']);
      }
      if(!empty($filters['subject'])){
        $q->andWhereIn('a.area_id', array_values($filters['subject']));
      }

      return $q->execute();
    }

}
